@model animeAlley.Models.Utilizador
@{
    ViewData["Title"] = Model.Nome;
    var showsPorStatus = ViewBag.ShowsPorStatus as Dictionary<ListaStatus, List<ListaShows>>;
}

@if (Model.Banner == "bannerplaceholder.png")
{
    <div class="show-banner" style="background-image: url('/img/@Html.DisplayFor(Model => Model.Banner)')">
        <div class="show-banner-shadow"></div>
    </div>
}
else
{
    <div class="show-banner" style="background-image: url('/images/userBanners/@Html.DisplayFor(Model => Model.Banner)')">
        <div class="show-banner-shadow"></div>
    </div>
}

<div class="bg-secondary">
    <div class="user-header container">
        <div class="user-cover">
            @if (Model.Foto == "placeholder.png")
            {
                <div class="cover">
                    <img src="~/img/@Html.DisplayFor(Model => Model.Foto)" alt="@Html.DisplayFor(Model => Model.Nome) | Foto" />
                </div>
            }
            else
            {
                <div class="cover">
                    <img src="~/images/userFotos/@Html.DisplayFor(Model => Model.Foto)" alt="@Html.DisplayFor(Model => Model.Nome) | Foto" />
                </div>
            }
        </div>
        <div class="user-name text-start">
            <h2 class="fw-bold">@Html.DisplayFor(Model => Model.Nome)</h2>
        </div>
    </div>
</div>

<div class="min-vh-100 container py-5">
    <div class="row">
            @if (showsPorStatus != null && showsPorStatus.Any())
            {
            <div class="user-list">
                <!-- Navegação por abas para diferentes status -->
                <ul class="nav lista-status" id="statusTabs" role="tablist">
                    <p class="m-0">Lista</p>
                    @{
                        bool isFirst = true;
                        var statusDisplayNames = new Dictionary<ListaStatus, string>
                        {
                            { ListaStatus.Assistir, "Assistindo" },
                            { ListaStatus.Terminei, "Terminei" },
                            { ListaStatus.Pausa, "Em Pausa" },
                            { ListaStatus.Desisti, "Desisti" },
                            { ListaStatus.Pensar_Assistir, "Planejo Assistir" }
                        };
                    }
                    
                    @foreach (var statusGroup in showsPorStatus.OrderBy(x => (int)x.Key))
                    {
                        <li class="nav-item" role="presentation">
                            <button class="nav-link @(isFirst ? "active" : "")" 
                                    id="@(statusGroup.Key.ToString().ToLower())-tab" 
                                    data-bs-toggle="tab" 
                                    data-bs-target="#@(statusGroup.Key.ToString().ToLower())" 
                                    type="button" 
                                    role="tab">
                                @statusDisplayNames[statusGroup.Key] 
                                <span>@statusGroup.Value.Count</span>
                            </button>
                        </li>
                        isFirst = false;
                    }
                </ul>

                <!-- Conteúdo das abas -->
                <div class="tab-content" id="statusTabsContent">
                    @{
                        isFirst = true;
                    }

                    @foreach (var statusGroup in showsPorStatus.OrderBy(x => (int)x.Key))
                    {
                        <div class="tab-pane fade @(isFirst ? "show active" : "")" 
                             id="@(statusGroup.Key.ToString().ToLower())" 
                             role="tabpanel">
                            <div class="user-show-grid">
                                @foreach (var listaShow in statusGroup.Value)
                                {
                                        <div class="user-show-grid-item">
                                            <a asp-controller="Shows" asp-action="Details" asp-route-id="@listaShow.Show.Id">
                                                <img src="~/images/showCover/@listaShow.Show.Imagem" alt="@listaShow.Show.Nome" title="@listaShow.Show.Nome" height="100px" />
                                                <div class="info">
                                                    <p class="title">@listaShow.Show.Nome</p>
                                                    <p class="type">@listaShow.Show.Tipo<span class="nota">@listaShow.Show.Nota</span></p>
                                                </div>
                                            </a>
                                        </div>
                                }
                            </div>
                        </div>
                        isFirst = false;
                    }
                </div>
            </div>
            }
            else
            {
                <div class="py-4" role="alert" style="width: 100%; margin: 0 auto">
                    <h1 class="text-center" style="color: #3D2D2D">Sua lista está vazia :(</h1>
                <p class="text-center" style="color: #3D2D2D">Vá para a aba de <a asp-controller="Shows" asp-action="Index" style="color: #3D2D2D">Shows</a> e adicione seus animes na lista!</p>
                </div>
            }
    </div>
</div>